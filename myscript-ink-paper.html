<!--
Copyright Â© MyScript.
LICENSE: github.com/MyScriptWebComponents/myscript-ink-paper/blob/master/LICENSE
-->
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-resizable-behavior/iron-resizable-behavior.html">
<link rel="import" href="../myscript/myscript.html">
<!--
The `myscript-ink-paper` contains MyScript Ink Paper.<br>
It is used to draw handwriting inks on an HTML5 canvas.

##### Example

    var recognized = function (e) {
        var data = e.detail;
        if (data) {
            var results = data.getMathDocument().getResultElements();
            for (var i in results) {
                if (results[i] instanceof MyScript.MathLaTexResultElement) {
                    result.innerHTML = results[i].getValue();
                }
            }
        } else {
            result.innerHTML = '';
        }
    };

    var error = function (e) {
        if (e) {
            result.innerHTML = e;
        }
    };
    ...
    <myscript-ink-paper
        type="MATH"
        timeout="2000"
        application-key="XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX"
        hmac-key="XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX"
        on-error="error"
        on-result="recognized">
    </myscript-ink-paper>

@group MyScript Elements
@element myscript-ink-paper
@blurb MyScript Ink Paper to help developer for integrate handwriting recognition.
@status alpha
@homepage http://myscriptwebcomponents.github.io/myscript-ink-paper

@demo demo/index.html Basic Demo
-->
<dom-module id="myscript-ink-paper"></dom-module>
<script>
    Polymer({
        is: 'myscript-ink-paper',
        properties: {
            /**
             * Width
             *
             * @attribute width
             * @type Number
             * @default 400
             */
            width: {
                type: Number,
                notify: true,
                observer: '_widthChanged'
            },
            /**
             * Height
             *
             * @attribute height
             * @type Number
             * @default 300
             */
            height: {
                type: Number,
                notify: true,
                observer: '_heightChanged'
            },
            /**
             * Recognition type
             *
             * @attribute type
             * @type String
             * @default 'TEXT'
             */
            type: {
                type: String,
                notify: true,
                observer: '_typeChanged'
            },
            /**
             * Recognition timeout
             *
             * @attribute timeout
             * @type Number
             * @default 2000
             */
            timeout: {
                type: Number,
                notify: true,
                observer: '_timeoutChanged'
            },
            /**
             * Application key to use for recognition on MyScript handwriting recognition server.<br>
             * You have to create your own MyScript Developer account at http://dev.myscript.com and then generate your application key at http://cloud.myscript.com.<br>
             * <b>Warning</b> : This parameter is <b>mandatory</b> and it's value should be a string.
             *
             * @attribute application-key
             * @type String
             */
            applicationKey: {
                type: String,
                notify: true,
                observer: '_applicationKeyChanged'
            },
            /**
             * Hmac key to use for recognition on MyScript handwriting recognition server.<br>
             * You have to create your own hmac key corresponding to your own application key in your account at http://cloud.myscript.com.<br>
             * <b>Warning</b> : This parameter may be <b>mandatory</b> if HMAC signature security is enable for your application. The value should be a string.
             *
             * @attribute hmac-key
             * @type String
             */
            hmacKey: {
                type: String,
                notify: true,
                observer: '_hmacKeyChanged'
            }
        },
        behaviors: [
            Polymer.IronResizableBehavior
        ],
        listeners: {
            'iron-resize': '_onResize'
        },
        /**
         * Clear all context
         *
         * @method clear
         */
        clear: function () {
            if (this._inkPaper) {
                this._inkPaper.clear();
            }
        },
        /**
         * Undo action, and launch recognition if timeout is set
         *
         * @method undo
         */
        undo: function () {
            if (this._inkPaper) {
                this._inkPaper.undo();
            }
        },
        /**
         * Redo action, and launch recognition if timeout is set
         *
         * @method redo
         */
        redo: function () {
            if (this._inkPaper) {
                this._inkPaper.redo();
            }
        },
        /**
         * Launch recognition
         *
         * @method recognize
         */
        recognize: function () {
            if (this._inkPaper) {
                this._inkPaper.recognize();
            }
        },
        get parent() {
            if (this.parentNode.nodeType === Node.DOCUMENT_FRAGMENT_NODE) {
                return this.parentNode.host;
            }
            return this.parentNode;
        },
        attached: function () {
            this.async(this.notifyResize, 1);
        },
        ready: function () {

            var options = {
                type: this.type,
                width: this.width,
                height: this.height,
                timeout: this.timeout,
                applicationKey: this.applicationKey,
                hmacKey: this.hmacKey
            };
            this._inkPaper = new MyScript.InkPaper(this, options, function (data, err) {
                if (data) {
                    this.fire('result', data);
                }
                if (err) {
                    this.fire('error', err);
                }
            }.bind(this));
        },
        _onResize: function () {
            if (this._inkPaper) {
                if (!this.width && (this.parent.offsetWidth > 0)) {
                    this._inkPaper.setWidth(this.parent.offsetWidth);
                }
                if (!this.height && (this.parent.offsetHeight > 0)) {
                    this._inkPaper.setHeight(this.parent.offsetHeight);
                }
            }
        },
        /**
         * Width changed observer
         *
         * @private
         * @method _widthChanged
         */
        _widthChanged: function () {
            if (this._inkPaper) {
                this._inkPaper.setWidth(this.width);
            }
        },
        /**
         * Height changed observer
         *
         * @private
         * @method _heightChanged
         */
        _heightChanged: function () {
            if (this._inkPaper) {
                this._inkPaper.setHeight(this.height);
            }
        },
        /**
         * Application key changed observer
         *
         * @private
         * @method _applicationKeyChanged
         */
        _applicationKeyChanged: function () {
            if (this._inkPaper) {
                this._inkPaper.setApplicationKey(this.applicationKey);
            }
        },
        /**
         * HMAC key changed observer
         *
         * @private
         * @method _hmacKeyChanged
         */
        _hmacKeyChanged: function () {
            if (this._inkPaper) {
                this._inkPaper.setHmacKey(this.hmacKey);
            }
        },
        /**
         * Timeout changed observer
         *
         * @private
         * @method _timeoutChanged
         */
        _timeoutChanged: function () {
            if (this._inkPaper) {
                this._inkPaper.setTimeout(this.timeout);
            }
        },
        /**
         * Recognition type changed observer
         *
         * @private
         * @method _typeChanged
         */
        _typeChanged: function () {
            if (this._inkPaper) {
                this._inkPaper.setType(this.type);
            }
        }
    });
</script>
